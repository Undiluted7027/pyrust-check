// Constraint solver (Phase 4)