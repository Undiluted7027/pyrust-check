// Constraint generation (Phase 4)